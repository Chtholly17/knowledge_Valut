SOC的总体架构如下图所示：![[Pasted image 20221122011244.png]]
- 我们的AI-IP和SRAM就像其他外设接口一样，挂载在外设总线上，来看看这几个外设是怎么访问总线以及地址映射的，这一部分在hbird2.h中![[Pasted image 20221122011704.png]]以上地址映射可以和书上的地址映射关系对应![[Pasted image 20221023224859.png]]如果我们需要进行什么修改，也应该把我们添加的AI-IP与SRAM接口添加在这里，设置起始地址偏移即可
- 以下语句，定义了多个接口的具体位置，为其添加了对应的指针，并且可以通过offset直接访问寄存器![[Pasted image 20221122012003.png]]此处也需要进行响应的修改
- 关于每个接口中的寄存器，同样在这个头文件中使用typedef定义结构体实现![[Pasted image 20221122012110.png]]以上就是可以访问的全部寄存器，可以直接使用offset进行访问。
- 关于具体操作，定义在driver中，如下图所示，我们讨论I2C接口，对应的头文件中定义了一些工作相关的宏以及进行操作的成员函数![[Pasted image 20221122012339.png]]
- 观察某一个成员函数的实现，比如i2c_send_data，实际上就是把需要写入的数据放入这个寄存器中（直接完成了总线的访问），之后接口会进行接下来的工作，将数据从寄存器中取出![[Pasted image 20221122012703.png]]
- 实际上的工作就是设置对应的结构体，并且进行地址映射，然后创建相关的类并且设置成员函数即可。