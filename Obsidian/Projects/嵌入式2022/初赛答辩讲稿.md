# 系统总体架构
![[Pasted image 20221118035710.png]]
- 为方便管理和调试，本系统暂时将AI-IP模块和SRAM模块挂载在系统外设总线上，通过地址映射将模块的控制寄存器映射到存储系统中，CPU通过访问外设总线，实现与AI-IP与SRAM的通信，控制整个SOC系统有序工作
# ICB总线通信
![[Pasted image 20221118040228.png]]
- 蜂鸟E203 开源系统采用自定义ICB总线，总线读写时序如下图所示，我们已经完成相关模块与总线之间接口的开发，并设置好了对应的控制寄存器，CPU可以直接通过RISCV指令对我们的AI-IP模块进行控制
# 开发流程与进度
- 采用Nucleistudio RISCV 集成开发环境，使用HummingBird RISC-V Software Development Kit进行开发
- 预期实现的功能：
	- 系统初始化阶段
		- SOC系统在初始化过程中，AI-IP模块初始化完毕后，向CPU发出数据请求，CPU监听外设总线上的argue-request请求，收到请求后，CPU向AI-IP接口发送握手信号，并进入中断准备接收地址。之后AI-IP模块将通过总线，向CPU发送首个参数的地址。
		- CPU收到首个参数地址之后，向SRAM发出数据请求信号。SRAM接口随时监听总线上的数据请求信号，收到请求后，在空闲状态下向CPU发送握手信号。（考虑到系统的复用性，假设有其他设备访问SRAM时暂时不会响应CPU的数据请求）
		- CPU监听到该握手信号之后，向SRAM发送AI-IP需要读取的地址。SRAM收取到地址之后，取出对应的参数，存放在接口寄存器中，并向CPU发出数据完毕信号
		- CPU收到数据完毕信号之后，向SRAM接口发出ready信号，进入中断准备接收数据
		- SRAM接收到ready信号后，将准备好的参数通过总线发送给CPU。CPU接收参数后，向AI-IP接口发出argue-ready信号，并紧接着发送参数。
		- AI-IP接口在发送地址后，监听总线。收到argue-ready信号后，立刻准备在接下来连续的周期中读取CPU从SRAM中取回的信息。接收完毕之后用于初始化AI-IP中对应的参数
		- 以上步骤不断重复，直到AI-IP模块全部参数初始化完毕，不再发送argue-request信号为止
	- 图像读取阶段
		- 需要识别的图像事先存放在SRAM中，当AI-IP模块初始化结束之后，会继续向CPU发送data-request信号，整个流程类似于参数读取，不再赘述。不断重复P _θ_此过程直到AI-IP读取完图片信息，不再发送data-request为止。
	- 可以进一步改进的功能：增添错误状态处理，当提供给SRAM的地址非法时，SRAM应当向CPU发送错误信息，拒绝CPU的访问。
	-  当前进度：SOC系统仍在开发过程中，整体框架已经构建，但信号传输过程存在一些bug，需要与各个模块的接口进行联合调试以解决信号无法正常接收的问题，接下来准备在SOC系统开发完毕后将简单的系统转化为RSICV指令烧写到SOC中，以实现整个系统的完整工作流程。