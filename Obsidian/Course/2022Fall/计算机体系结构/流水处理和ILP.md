## 流水线的性能分析
### 吞吐率
* 定义：单位时间内流水线所能流出的任务数或能 流出的结果数
* 公式：$Tp = \frac{n}{T_m}$  n：任务数，$T_m$ ：处理完成n个任务所用的时间
* 各种情况分析
	1. 各时间均相等
		假设在流水线各段的执行时间（$\Delta t$  ）均相等，输入到 流水线中的任务是连续的理想情况下，一条单功能m段线性流水线能够在m+n-1个$\Delta t$ 时间内完成n个任务。![[Pasted image 20221017195836.png]]
	2. 各时间段不相等![[Pasted image 20221017201543.png]]
* 瓶颈：吞吐率和最大吞吐率由流水线中执行时间最长的功能段决定，成为整个流水线的瓶颈。![[Pasted image 20221017202650.png]]
$\Delta t_2$就是上述流水线中的瓶颈
解决方式：
	1. 将流水线中的瓶颈再细分
	2. 重复设置多套瓶颈功能段，让多个瓶颈功能段并行工作![[Pasted image 20221017202830.png]]



### 加速比
* 定义：完成同样一批任务，不使用流水线完成所用的 时间与使用流水线完成所用的时间之比。
* 公式：$S=\frac{T_0}{T_m}$  $T_0$：顺序执行所用的时间
* 情况分析
	1. 各段时间均相等
		![[Pasted image 20221017210518.png]]
	2. 各段时间不相同
		![[Pasted image 20221017210601.png]]
### 效率
* 定义：是指流水线的设备利用率。在时空图上，流水 线的效率定义为n个任务占用的时空区与m个功能 段总的时空区之比（下图中黄色区域与绿色区域面积之比）
		![[Pasted image 20221017205312.png]]
* 情况分析：
	1. 各段时间均相等	![[Pasted image 20221017205531.png]]
	2. 各段时间不相等	![[Pasted image 20221017205547.png]]
		功能段权值不同，也就是每个小矩形的高度不同![[Pasted image 20221017205728.png]]
### 性价比
* 功能段数量的增加能提高流水线的吞吐率和加 速比，但使流水线价格增加，所以从性价比角度出发流水线 存在着最佳段数。
* 性价比：![[Pasted image 20221017210841.png]]
## 相关性分析技术
### 基本概念
* 相关：指邻近指令之间存在着某种关系，影响指令 的重叠执行或流水线的正常运行。
* 有三种类型的相关：
	资源相关：争用部件。 
	数据相关：改变操作数的读写顺序，使得顺序执行与 流水执行时结果不同。 
	控制相关：分支、转子程序、中断。
### 环境说明：
* Mips基本流水线：每一条RISC指令的执行至多需要5个时钟周期：取指令 周期（IF）、指令译码/读寄存器周期（ID）、执行/有效地 址周期（EX）、访问存储器周期（MEM）和写回周期 （WB）。
	1. 取指周期
		根据PC指示的地址从存储器中取指令并装入 指令寄存器（IR），同时PC加4以获取下一条指 令的地址。IR中保存下一个时钟周期需要的指令， NPC中保存下一条指令的PC。![[Pasted image 20221017215638.png]]
		```

		IR ← Mem[PC]
		NPC ← PC+4 
		```
	2. 指令译码/读寄存器周期
		分析指令并访问寄存器堆以读寄存器，并结束分支指 令（为简单只设置一条：BEQZ）的操作。![[Pasted image 20221017220106.png]]
		```
		A ← Regs[rs]
		B ← Regs[rt]
		Imm ← IR的立即数字段进行符号扩展
		ALUOutput ← NPC+(Imm<<2) 
		Cond ← (A==0) 
		if (cond) PC ← ALUOutput
		```
		
	3. 执行/有效地址周期
		![[Pasted image 20221017220207.png]]
		![[Pasted image 20221017220230.png]]
		
	4. 访问存储器周期
		Load指令从存储器中读出数据并装入 LMD（装入存储器数据）寄存器，Store指 令将寄存器B中的数据写入存储器。![[Pasted image 20221017220334.png]]
		```
		LMD← Mem[ALUOutput] or Mem[ALUOutput] ← B
		```
		
	5. 写回周期
		![[Pasted image 20221017220350.png]]
		![[Pasted image 20221017220408.png]]
* 时空图：
		![[Pasted image 20221017220652.png]]
* Mips拓展流水线：在MIPS基本流水线中引入浮点操作功能。

### 资源相关
* 因为资源冲突而导致流水线断流。![[Pasted image 20221017221205.png]]
* 解决方式：通过设置足够的重复资源
